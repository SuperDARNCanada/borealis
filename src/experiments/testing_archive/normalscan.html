<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>normalscan.py</title>
</head>
<!-- Highlighting: "Python" -->
<body>
<pre style='color:#1f1c1b;background-color:#ffffff;'>
<span style='color:#898887;'>#!/usr/bin/python</span>

<span style='color:#898887;'># write an experiment that creates a new control program.</span>
<span style='color:#ff5500;'>from</span> experiment_prototype <span style='color:#ff5500;'>import</span> ExperimentPrototype


<b>class</b> Normalscan(ExperimentPrototype):
    <b>def</b> <span style='color:#644a9b;'>__init__</span>(<span style='color:#0057ae;'>self</span>):
        cpid = <span style='color:#b08000;'>150</span>
        <b><span style='color:#644a9b;'>super</span></b>(Normalscan, <span style='color:#0057ae;'>self</span>).<span style='color:#644a9b;'>__init__</span>(cpid)

        <span style='color:#0057ae;'>self</span>.add_slice({
            <span style='color:#bf0303;'>&quot;txantennas&quot;</span>: [<span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>1</span>, <span style='color:#b08000;'>2</span>, <span style='color:#b08000;'>3</span>, <span style='color:#b08000;'>4</span>, <span style='color:#b08000;'>5</span>, <span style='color:#b08000;'>6</span>, <span style='color:#b08000;'>7</span>, <span style='color:#b08000;'>8</span>, <span style='color:#b08000;'>9</span>, <span style='color:#b08000;'>10</span>, <span style='color:#b08000;'>11</span>, <span style='color:#b08000;'>12</span>, <span style='color:#b08000;'>13</span>, <span style='color:#b08000;'>14</span>, <span style='color:#b08000;'>15</span>],
            <span style='color:#bf0303;'>&quot;rxantennas&quot;</span>: [<span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>1</span>, <span style='color:#b08000;'>2</span>, <span style='color:#b08000;'>3</span>, <span style='color:#b08000;'>4</span>, <span style='color:#b08000;'>5</span>, <span style='color:#b08000;'>6</span>, <span style='color:#b08000;'>7</span>, <span style='color:#b08000;'>8</span>, <span style='color:#b08000;'>9</span>, <span style='color:#b08000;'>10</span>, <span style='color:#b08000;'>11</span>, <span style='color:#b08000;'>12</span>, <span style='color:#b08000;'>13</span>, <span style='color:#b08000;'>14</span>, <span style='color:#b08000;'>15</span>],
            <span style='color:#bf0303;'>&quot;sequence&quot;</span>: [<span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>14</span>, <span style='color:#b08000;'>22</span>, <span style='color:#b08000;'>24</span>, <span style='color:#b08000;'>27</span>, <span style='color:#b08000;'>31</span>, <span style='color:#b08000;'>42</span>, <span style='color:#b08000;'>43</span>],
            <span style='color:#bf0303;'>&quot;pulse_shift&quot;</span>: [<span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>0</span>, <span style='color:#b08000;'>0</span>],
            <span style='color:#bf0303;'>&quot;mpinc&quot;</span>: <span style='color:#b08000;'>1500</span>,  <span style='color:#898887;'># us</span>
            <span style='color:#bf0303;'>&quot;pulse_len&quot;</span>: <span style='color:#b08000;'>300</span>,  <span style='color:#898887;'># us</span>
            <span style='color:#bf0303;'>&quot;nrang&quot;</span>: <span style='color:#b08000;'>75</span>,  <span style='color:#898887;'># range gates</span>
            <span style='color:#bf0303;'>&quot;frang&quot;</span>: <span style='color:#b08000;'>90</span>,  <span style='color:#898887;'># first range gate, in km</span>
            <span style='color:#bf0303;'>&quot;intt&quot;</span>: <span style='color:#b08000;'>3000</span>,  <span style='color:#898887;'># duration of an integration, in ms</span>
            <span style='color:#bf0303;'>&quot;intn&quot;</span>: <span style='color:#b08000;'>21</span>,  <span style='color:#898887;'># number of averages if intt is None.</span>
            <span style='color:#bf0303;'>&quot;beam_angle&quot;</span>: [-<span style='color:#b08000;'>26.25</span>, -<span style='color:#b08000;'>22.75</span>, -<span style='color:#b08000;'>19.25</span>, -<span style='color:#b08000;'>15.75</span>, -<span style='color:#b08000;'>12.25</span>, -<span style='color:#b08000;'>8.75</span>,
                           -<span style='color:#b08000;'>5.25</span>, -<span style='color:#b08000;'>1.75</span>, <span style='color:#b08000;'>1.75</span>, <span style='color:#b08000;'>5.25</span>, <span style='color:#b08000;'>8.75</span>, <span style='color:#b08000;'>12.25</span>, <span style='color:#b08000;'>15.75</span>, <span style='color:#b08000;'>19.25</span>, <span style='color:#b08000;'>22.75</span>, <span style='color:#b08000;'>26.25</span>],
            <span style='color:#bf0303;'>&quot;beam_order&quot;</span>: [<span style='color:#b08000;'>15</span>, <span style='color:#b08000;'>14</span>, <span style='color:#b08000;'>13</span>, <span style='color:#b08000;'>12</span>, <span style='color:#b08000;'>11</span>, <span style='color:#b08000;'>10</span>, <span style='color:#b08000;'>9</span>, <span style='color:#b08000;'>8</span>, <span style='color:#b08000;'>7</span>, <span style='color:#b08000;'>6</span>, <span style='color:#b08000;'>5</span>, <span style='color:#b08000;'>4</span>, <span style='color:#b08000;'>3</span>, <span style='color:#b08000;'>2</span>, <span style='color:#b08000;'>1</span>, <span style='color:#b08000;'>0</span>],
            <span style='color:#bf0303;'>&quot;scanboundflag&quot;</span>: <span style='color:#0057ae;'>True</span>,
            <span style='color:#bf0303;'>&quot;scanbound&quot;</span>: <span style='color:#b08000;'>60000</span>,
            <span style='color:#bf0303;'>&quot;txfreq&quot;</span>: <span style='color:#b08000;'>12300</span>,
            <span style='color:#bf0303;'>&quot;rxfreq&quot;</span>: <span style='color:#b08000;'>12300</span>,
            <span style='color:#bf0303;'>&quot;clrfrqflag&quot;</span>: <span style='color:#0057ae;'>True</span>,
            <span style='color:#bf0303;'>&quot;clrfrqrange&quot;</span>: [<span style='color:#b08000;'>12200</span>, <span style='color:#b08000;'>12500</span>],
            <span style='color:#bf0303;'>&quot;xcf&quot;</span>: <span style='color:#0057ae;'>True</span>,
            <span style='color:#bf0303;'>&quot;acfint&quot;</span>: <span style='color:#0057ae;'>True</span>,
            <span style='color:#bf0303;'>&quot;wavetype&quot;</span>: <span style='color:#bf0303;'>&quot;SINE&quot;</span>,
            <span style='color:#bf0303;'>&quot;seqtimer&quot;</span>: <span style='color:#b08000;'>0</span>
        })

        <span style='color:#898887;'># Other things you can change if you wish. You may want to discuss with us about it beforehand.</span>
        <span style='color:#898887;'># self.txctrfreq = 12000 # kHz, oscillator mixer frequency on the USRP for TX</span>
        <span style='color:#898887;'># self.txrate = 12000000 # Hz, sample rate fed to DAC</span>
        <span style='color:#898887;'># self.rxctrfreq = 12000 # kHz, mixer frequency on the USRP for RX</span>
        <span style='color:#898887;'># self.xcf = True # flag for cross-correlation data between main and interferometer</span>
        <span style='color:#898887;'># self.acfint = True # flag for auto-correlation with interferometer data.</span>

        <span style='color:#898887;'>&quot;&quot;&quot;</span><span style='color:#898887;'> </span>
<span style='color:#898887;'>        INTERFACING TYPES:</span>
<span style='color:#898887;'>        </span>
<span style='color:#898887;'>        NONE : Only the default, must be changed.</span>
<span style='color:#898887;'>        SCAN : Scan by scan interfacing. Experiment slice #1 will scan first </span>
<span style='color:#898887;'>            followed by slice #2 and subsequent slices.</span>
<span style='color:#898887;'>        INTTIME : nave by nave interfacing (full integration time of</span>
<span style='color:#898887;'>             one sequence, then the next). Time/number of sequences </span>
<span style='color:#898887;'>            dependent on intt and intn in the slice. Effectively </span>
<span style='color:#898887;'>            simultaneous scan interfacing, interleaving each </span>
<span style='color:#898887;'>            integration time in the scans. Slice #1 first inttime or </span>
<span style='color:#898887;'>            beam direction will run followed by slice #2's first inttime,</span>
<span style='color:#898887;'>            etc. if slice #1's len(beam_order) is greater than slice #2's, slice </span>
<span style='color:#898887;'>            #2's last integration will run and then all the rest of slice</span>
<span style='color:#898887;'>            #1's will continue until the full scan is over. Experiment slice #1</span>
<span style='color:#898887;'>            and 2 must have the same scan boundary, if any boundary. </span>
<span style='color:#898887;'>            All other may differ.</span>
<span style='color:#898887;'>        INTEGRATION : integration by integration interfacing (one </span>
<span style='color:#898887;'>            sequence of one slice, then the next). Experiment slice #1 and</span>
<span style='color:#898887;'>            #2 must have same intt and intn. Integrations will </span>
<span style='color:#898887;'>            switch between one and the other until time is up/nave is</span>
<span style='color:#898887;'>            reached.</span>
<span style='color:#898887;'>        PULSE : Simultaneous sequence interfacing, pulse by pulse </span>
<span style='color:#898887;'>            creates a single sequence. Experiment Slice 1 and 2 might have different</span>
<span style='color:#898887;'>            frequencies (stereo) and/or may have different pulse </span>
<span style='color:#898887;'>            length, mpinc, sequence, but must have the same integration</span>
<span style='color:#898887;'>            time. They must also have same len(scan), although they may</span>
<span style='color:#898887;'>            use different directions in scan. They must have the same </span>
<span style='color:#898887;'>            scan boundary if any. A time offset between the pulses </span>
<span style='color:#898887;'>            starting may be set (seq_timer in the slice). Slice 1 </span>
<span style='color:#898887;'>            and 2 will have integrations that run at the same time. </span>
<span style='color:#898887;'>        </span><span style='color:#898887;'>&quot;&quot;&quot;</span>

        <span style='color:#898887;'># Update the following interface dictionary if you have more than one slice dictionary in your slice_list.</span>
        <span style='color:#898887;'># The keys in the interface dictionary correspond to the slice_ids of the slices in your slice_list.</span>

        <span style='color:#898887;'># </span><b><span style='color:#81ca2d;background:#f7e6e6;'>NOTE</span></b><span style='color:#898887;'> keys are as such: (0,1), (0,2), (1,2), NEVER includes (2,0) etc.</span>

    <span style='color:#898887;'>#        self.interface.update({</span>
    <span style='color:#898887;'>#            (0,1) : 'PULSE'</span>
    <span style='color:#898887;'>#        })</span>

    <b>def</b> update(<span style='color:#0057ae;'>self</span>, acfdata):
        <span style='color:#898887;'>&quot;&quot;&quot;</span>
<span style='color:#898887;'>        Use this function to change your experiment based on ACF data retrieved from the rx_signal_processing block. </span>
<span style='color:#898887;'>        This function is called after every integration period so that your experiment can be changed to adjust to </span>
<span style='color:#898887;'>        existing conditions. Talk to us if you have something specific in mind that you're not sure if you can </span>
<span style='color:#898887;'>        implement here. </span>

<span style='color:#898887;'>        :param acfdata ??? </span><b><span style='color:#ca9219;background:#451e1a;'>TBD</span></b>
<span style='color:#898887;'>        :rtype boolean</span>
<span style='color:#898887;'>        :return change_flag, indicating whether the experiment has changed or not. True = change has occurred.</span>
<span style='color:#898887;'>        </span><span style='color:#898887;'>&quot;&quot;&quot;</span>  <span style='color:#898887;'># </span><b><span style='color:#ca9219;background:#451e1a;'>TODO</span></b><span style='color:#898887;'> update with how acfdata will be passed in</span>

        change_flag = <span style='color:#0057ae;'>False</span>
        <b>return</b> change_flag
</pre>
</body>
</html>
